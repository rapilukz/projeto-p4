{% extends 'base.html' %} 

{% block head %}
<title>Statistics</title>
{% endblock %}

{% block body %}
<form class="container mt-3" id="prediction-form">
    <h1 class="mt-3">Price Prediction</h1>
    <div class="d-flex">
        <div style="width: 50%;">
            <label for="store">Choose a store:</label>
            <select class="form-select form-control" id="store" name="store">
                {% for store in storeSummary_df['store'].unique() %}
                <option value="{{ store }}">{{ store }}</option>
                {% endfor %}
            </select>
        
            <label for="price">Enter price:</label>
            <input type="number" class="form-control" min="0" id="price" name="price">
        
            <label for="model">Choose a model:</label>
            <select id="model" class="form-select form-control" name="model">
                <option value="Linear Regression">Linear Regression</option>
                <option value="Decision Trees">Decision Trees</option>
                <option value="Neural Network">Neural Network</option>
            </select>
        
            <button type="submit" class="btn btn-primary mt-3">Predict</button>
        </div>
        <div>
            <h3>Result:</h3>
            <div id="prediction-result" class="mt-2">
                <div class="prediction-text">Amazon: <span class="prediction-price">0.00 </span></div>
                <div class="prediction-text">Chip7: <span class="prediction-price">0.00 </span></div>
                <div class="prediction-text">Nanochip: <span class="prediction-price">0.00 </span></div>
                <div class="prediction-text">PC Componentes: <span class="prediction-price">0.00 </span></div>
                <div class="prediction-text">PC Diga: <span class="prediction-price">0.00 </span></div>
                <div class="prediction-text">Worten: <span class="prediction-price">0.00 </span></div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>

document.getElementById('prediction-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const store = document.getElementById('store').value;
    const price = document.getElementById('price').value;
    const model = document.getElementById('model').value;

    fetch('/api/predict', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            store: store,
            price: price,
            model: model
        })
    })
    .then(response => response.json())
    .then(data => {
        const prediction = data.prediction;
        document.getElementById('prediction-result').innerHTML = `
            <div class="prediction-text">Amazon: <span class="prediction-price">${prediction.Amazon.toFixed(2)} <span/></div>
            <div class="prediction-text">Chip7: <span class="prediction-price">${prediction.Chip7.toFixed(2)} <span/></div>
            <div class="prediction-text">Nanochip: <span class="prediction-price">${prediction.Nanochip.toFixed(2)} <span/></div>
            <div class="prediction-text">PC Componentes: <span class="prediction-price">${prediction["PC Componentes"].toFixed(2)} <span/></div>
            <div class="prediction-text">PC Diga: <span class="prediction-price">${prediction["PC Diga"].toFixed(2)} <span/></div>
            <div class="prediction-text">Worten: <span class="prediction-price">${prediction.Worten.toFixed(2)} <span/></div>
        `;
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

</script>
{% endblock %}